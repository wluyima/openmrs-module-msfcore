<htmlform
        formUuid="30d1fda4-4161-4666-ad0c-e2ba20eb73a6"
        formName="Allergies"
        formDescription="Allergies for NCD baseline consultation"
        formEncounterType="fa6f3ff5-b784-43fb-ab35-a08ab7dbf074"
        formVersion="1.1" formAddMetadata="no">
    <!-- Autogenerated example form  (template from 01-Nov-2010 -->
    <macros>
        paperFormId = (Fill this in)
        headerColor =#009d8e
        fontOnHeaderColor = white
    </macros>

    <script type="text/javascript">
        if (jQuery) {
            jq(document).ready(function () {
                // enabling and disabling the allergy sections there are only 5 so far
                jq('#1-removeEntry').remove();
                jq('#1-toggleContainer').show();
                jq('#10-addEntry').remove();

                // show and remove sections 
                jq('button.addEntry').on("click", function(){
                    var correctedAddButtonId = parseFloat(this.id) + 1;
                    var contentAddId = "#" + correctedAddButtonId + "-toggleContainer";
                    jq(contentAddId).toggle(true);
                    jq('#' + this.id).toggle(false);
                    jq('#' + parseFloat(this.id) + '-removeEntry').toggle(false);
                    return false;
                });

                jq('button.removeEntry').on("click", function () {
                    var correctedRemoveButtonId = parseFloat(this.id) - 1;
                    var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer";
                    jq(contentAddId).toggle(false);
                    jq(':input:not(:button)', contentAddId).val([]);
                    jq('#' + correctedRemoveButtonId + '-addEntry').toggle(true);
                    jq('#' + correctedRemoveButtonId + '-removeEntry').toggle(true);
                    return false;
                });

                // show any allergies that have been saved
                for (i = 1; i &lt; 10; i++) {
                    if (getValue('allergy-type-' + i + '.value') != false) {
                        jq('#' + i + '-addEntry').toggle(false);
                        jq('#' + i + '-toggleContainer').show();
                    }
                }
            });
        }
    </script>

    <div class="wrapper">
        <uiInclude provider="msfcore" fragment="leftMenu"/>
        <div class="right-form-display">

            <div style="display:none;">
                <section headerLabel="Encounter Details">
                    <table class="baseline-aligned">
                        <tr>
                            <td>Date:</td>
                            <td>
                                <encounterDate default="now" disallowMultipleEncountersOnDate="block"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Location:</td>
                            <td>
                                <encounterLocation default="SessionAttribute:emrContext.sessionLocationId"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Provider:</td>
                            <td>
                                <encounterProvider default="currentUser"/>
                            </td>
                        </tr>
                    </table>
                </section>
            </div>

            <div class="sections-container">
                <section headerLabel="Allergies">
                    <repeat>
                        <template>
                            <div id="{allergy}-toggleContainer" style="display: none;">
                                <table class="baseline-aligned">
                                    <tr>
                                        <td>
                                            <lookup expression="fn.getConcept('465115').name"/>
                                        </td>
                                        <td nowrap="nowrap">
                                            <obs id="allergy-type-{allergy}" conceptId="465115"
                                                 answerConceptIds="162553,162552,162554" answerLabels="Food,Drug,Other"
                                                 style="radio" answerSeparator=""/>
                                            <br/>
                                            <p id="162553-{allergy}" class="enableDisable allergy-{allergy}">
                                                <obsgroup groupingConceptId="162553">
                                                    <obs conceptId="465116" style="radio" answerSeparator=""/>
                                                </obsgroup>
                                            </p>
                                            <p id="162552-{allergy}" class="enableDisable allergy-{allergy}">
                                                <obsgroup groupingConceptId="162552">
                                                    <obs conceptId="465112" style="radio" answerSeparator=""/>
                                                </obsgroup>
                                            </p>
                                            <p id="162554-{allergy}" class="enableDisable allergy-{allergy}">
                                                <obsgroup groupingConceptId="162554">
                                                    <obs conceptId="465113" style="radio" answerSeparator=""/>
                                                </obsgroup>
                                            </p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Allergic Reactions (check all that apply)
                                        </td>
                                        <td>
                                            <obsgroup groupingConceptId="162555">
                                                <obs conceptId="465114" answerConceptId="121677" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="121629" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="148888" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="139084" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="148787" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="108" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="120148" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="143264" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="142412" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="118773" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="140238" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="140039" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="139581" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="117399" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="136455" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="159347" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="121" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="512" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="159098" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="111061" style="checkbox"/>
                                                <obs conceptId="465114" answerConceptId="1067" style="checkbox"/>
                                                <obs conceptId="465116" answerConceptId="5622" style="checkbox"
                                                     commentFieldLabel="Specify:"/>
                                            </obsgroup>

                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Severity</td>
                                        <td>

                                            <obs conceptId="162820" answerConceptIds="1498,1499,1500" style="radio"
                                                 answerLabels="Mild, Moderate, Severe"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Comment</td>
                                        <td>

                                            <obs conceptId="161011" style="textarea" rows="3"/>
                                        </td>
                                    </tr>
                                    <tfoot class="hide-on-view">
                                    <tr>
                                        <td></td>
                                        <td><button class="addEntry" id="{allergy}-addEntry">Add Allergy</button> | <button
                                                class="removeEntry" id="{allergy}-removeEntry">Remove Allergy</button>
                                        </td>
                                    </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <script>
                                jq(document).ready(function () {
                                    <!-- show and hide the different types of allergies -->
                                    jq("#allergy-type-{allergy}").change(function () {
                                        <!-- disable all the allergy sections and enable only the one which is selected -->
                                        disableFn(jq(".allergy-{allergy}"));
                                        enableFn("#" + getValue('allergy-type-{allergy}.value') + "-{allergy}");
                                    });
                                });
                            </script>
                        </template>
                        <render allergy="1"/>
                        <render allergy="2"/>
                        <render allergy="3"/>
                        <render allergy="4"/>
                        <render allergy="5"/>
                        <render allergy="6"/>
                        <render allergy="7"/>
                        <render allergy="8"/>
                        <render allergy="9"/>
                        <render allergy="10"/>
                    </repeat>
                </section>
            </div>
            <submit submitLabel="Next >"/>
        </div>
    </div>


    <!-- Enusre that only one version of this form can exist at any one time -->
    <ifMode mode="ENTER" include="true">
        <lookup complexExpression="
            #set( $encounter = 0 )
            #set( $encounter = $fn.allEncounters('fa6f3ff5-b784-43fb-ab35-a08ab7dbf074'))
            #foreach($encounter in $fn.allEncounters(null))
                #if( $encounter.form.uuid == '30d1fda4-4161-4666-ad0c-e2ba20eb73a6' )
                    &lt;script type=&quot;text/javascript&quot;>
                        window.location.href = window.location.protocol + &quot;//&quot; + window.location.host + &quot;/&quot;+ OPENMRS_CONTEXT_PATH + &quot;/htmlformentryui/htmlform/editHtmlFormWithStandardUi.page?formUuid=$encounter.form.uuid&amp;patientId=$patient.uuid&amp;encounterId=$encounter.uuid&amp;&quot;;
                    &lt;/script>
                #end
            #end"/>

    </ifMode>
    <redirectOnSave
            url="/htmlformentryui/htmlform/enterHtmlFormWithStandardUi.page?formUuid=7ba65c3e-3e16-4637-824f-ce23ccb30746&amp;patientId={{patient.id}}&amp;visitId={{visit.id}"/>
</htmlform>